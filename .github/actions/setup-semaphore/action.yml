---
name: Setup Semaphore environment
description: Connect to Tailscale and configure Semaphore API access

inputs:
  tailscale_oauth_client_id:
    required: true
    description: Tailscale OAuth client ID for connecting to tailnet
  tailscale_oauth_secret:
    required: true
    description: Tailscale OAuth client secret

runs:
  using: composite
  steps:
  - name: Connect to Tailscale
    uses: tailscale/github-action@53acf823325fe9ca47f4cdaa951f90b4b0de5bb9  # v4.1.1
    with:
      oauth-client-id: ${{ inputs.tailscale_oauth_client_id }}
      oauth-secret: ${{ inputs.tailscale_oauth_secret }}
      tags: tag:github-actions
      use-cache: true

  - name: Verify Semaphore connectivity
    shell: bash
    run: |
      set -euo pipefail
      curl -sf --max-time 10 "https://semaphore.cow-banjo.ts.net/api/ping" || {
        echo "Failed to reach Semaphore API"; exit 1
      }
