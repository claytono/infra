{
  "extends": [
    "config:best-practices"
  ],
  "timezone": "America/New_York",
  "schedule": [
    "on monday"
  ],
  "ignorePaths": [
    "ansible/galaxy/**"
  ],
  "rebaseWhen": "behind-base-branch",
  "minimumReleaseAge": "14 days",
  "prHourlyLimit": 0,
  "prConcurrentLimit": 0,
  "internalChecksFilter": "strict",
  "semanticCommits": "disabled",
  "addLabels": [
    "renovate"
  ],
  "pre-commit": {
    "enabled": true
  },
  "lockFileMaintenance": {
    "enabled": true
  },
  "kubernetes": {
    "managerFilePatterns": [
      "/kubernetes/.+\\.yaml$/"
    ],
    "ignorePaths": [
      "kubernetes/**/helm/**",
      "kubernetes/restic/cronjobs/**"
    ]
  },
  "customManagers": [
    {
      "customType": "regex",
      "managerFilePatterns": [
        "ansible/roles/resticprofile/defaults/main.yaml"
      ],
      "matchStrings": [
        "(?:^|\\n)\\s*restic_version:\\s*\"?(?<currentValue>\\d+\\.\\d+\\.\\d+)\"?\\s*(#.*)?"
      ],
      "depNameTemplate": "restic/restic",
      "datasourceTemplate": "github-releases"
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "ansible/roles/resticprofile/defaults/main.yaml"
      ],
      "matchStrings": [
        "(?:^|\\n)\\s*resticprofile_version:\\s*\"?(?<currentValue>\\d+\\.\\d+\\.\\d+)\"?\\s*(#.*)?"
      ],
      "depNameTemplate": "creativeprojects/resticprofile",
      "datasourceTemplate": "github-releases"
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "ansible/group_vars/all/node_exporter.yaml"
      ],
      "matchStrings": [
        "(?:^|\\n)\\s*node_exporter_version:\\s*\"?(?<currentValue>\\d+\\.\\d+\\.\\d+)\"?\\s*(#.*)?"
      ],
      "depNameTemplate": "prometheus/node_exporter",
      "datasourceTemplate": "github-releases"
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "ansible/requirements.yml"
      ],
      "matchStrings": [
        "name:\\s*https://github\\.com/(?<depName>[^\\s/]+/[^\\s.]+)\\.git\\s*\\n\\s*type:\\s*git\\s*\\n\\s*version:\\s*v?(?<currentValue>\\d+\\.\\d+\\.\\d+)"
      ],
      "datasourceTemplate": "github-tags",
      "versioningTemplate": "semver"
    },
    {
      "customType": "regex",
      "description": "Docker images with comment annotations (generic)",
      "managerFilePatterns": [
        "ansible/**/*.yaml",
        "ansible/**/*.yml"
      ],
      "matchStringsStrategy": "recursive",
      "matchStrings": [
        "#\\s*renovate:\\s*datasource=docker\\s*\\n\\s*[a-z0-9_]+:\\s*\"?[^\"\\n]+\"?",
        "(?<depName>[^:\"\\s]+):(?<currentValue>[^@\"\\s]+)(?:@(?<currentDigest>sha256:[a-f0-9]{64}))?"
      ],
      "datasourceTemplate": "docker",
      "autoReplaceStringTemplate": "{{{depName}}}:{{{newValue}}}{{#if newDigest}}@{{{newDigest}}}{{/if}}"
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "/.*\\.ya?ml$/"
      ],
      "matchStrings": [
        "imageName:\\s*(?<depName>ghcr\\.io/cloudnative-pg/postgresql):(?<currentValue>[A-Za-z0-9._-]+)(?:@(?<currentDigest>sha256:[A-Fa-f0-9]{64}))?"
      ],
      "datasourceTemplate": "docker",
      "registryUrlTemplate": "https://ghcr.io",
      "versioningTemplate": "docker"
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "esphome/scripts/esphome"
      ],
      "matchStrings": [
        "ESPHOME_VERSION=\"(?<currentValue>\\d+\\.\\d+\\.\\d+)\""
      ],
      "depNameTemplate": "esphome",
      "datasourceTemplate": "pypi"
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "ansible/roles/os-install/vars/main.yaml"
      ],
      "matchStrings": [
        "grml_version:\\s*\"(?<currentValue>\\d{4}\\.\\d{2})\""
      ],
      "depNameTemplate": "grml/grml",
      "datasourceTemplate": "github-releases",
      "versioningTemplate": "regex:^(?<major>\\d{4})\\.(?<minor>\\d{2})$"
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "scripts/rpi-image-customize"
      ],
      "matchStrings": [
        "IMAGE_TAG=\"(?<currentValue>\\d{4}-\\d{2}-\\d{2}-raspios-[^-]+-arm64)\""
      ],
      "datasourceTemplate": "github-tags",
      "depNameTemplate": "RPi-Distro/pi-gen",
      "versioningTemplate": "regex:^(?<major>\\d{4})-(?<minor>\\d{2})-(?<patch>\\d{2})-raspios-[^-]+-arm64$"
    },
    {
      "customType": "regex",
      "managerFilePatterns": [
        "kubernetes/got-your-back/run"
      ],
      "matchStrings": [
        "VERSION=(?<currentValue>\\d+\\.\\d+)"
      ],
      "depNameTemplate": "GAM-team/got-your-back",
      "datasourceTemplate": "github-releases"
    }
  ],
  "packageRules": [
    {
      "matchUpdateTypes": [
        "lockFileMaintenance"
      ],
      "enabled": false,
      "description": "Disable lockFileMaintenance globally (re-enabled per-manager below)"
    },
    {
      "matchManagers": [
        "ansible-galaxy"
      ],
      "matchPackageNames": [
        "https://github.com/artis3n/ansible-collection-tailscale.git"
      ],
      "enabled": false,
      "description": "Handle tailscale git collection via regex manager"
    },
    {
      "matchDatasources": [
        "helm"
      ],
      "matchManagers": [
        "helmv3"
      ],
      "matchFileNames": [
        "kubernetes/**/Chart.yaml"
      ]
    },
    {
      "matchPackageNames": [
        "ghcr.io/linuxserver/qbittorrent"
      ],
      "allowedVersions": "< 14",
      "description": "Only allow qbittorrent versions < 14 to avoid Ubuntu LTS tags"
    },
    {
      "matchPackageNames": [
        "linuxserver/radarr"
      ],
      "allowedVersions": "< 6",
      "description": "Block radarr 6.x"
    },
    {
      "matchManagers": [
        "pre-commit"
      ],
      "automerge": true,
      "automergeType": "pr",
      "addLabels": [
        "automerge"
      ],
      "description": "Auto-merge pre-commit hook updates if CI passes"
    },
    {
      "matchUpdateTypes": [
        "digest"
      ],
      "matchManagers": [
        "kustomize",
        "kubernetes"
      ],
      "minimumReleaseAge": "0 days",
      "automerge": true,
      "automergeType": "pr",
      "addLabels": [
        "automerge"
      ],
      "description": "Auto-merge Docker image digest updates in Kubernetes if CI passes"
    },
    {
      "matchDatasources": [
        "docker"
      ],
      "matchPackageNames": [
        "ghcr.io/cloudnative-pg/postgresql"
      ],
      "matchUpdateTypes": [
        "digest"
      ],
      "matchManagers": [
        "custom.regex"
      ],
      "minimumReleaseAge": "0 days",
      "automerge": true,
      "automergeType": "pr",
      "addLabels": [
        "automerge"
      ],
      "description": "Auto-merge CNPG digest refreshes for regex-managed imageName"
    },
    {
      "matchManagers": [
        "github-actions"
      ],
      "matchUpdateTypes": [
        "digest"
      ],
      "minimumReleaseAge": "0 days",
      "automerge": true,
      "automergeType": "pr",
      "addLabels": [
        "automerge"
      ],
      "description": "Auto-merge GitHub Actions digest updates if CI passes"
    },
    {
      "matchDatasources": [
        "docker"
      ],
      "matchManagers": [
        "custom.regex",
        "docker-compose"
      ],
      "matchFileNames": [
        "ansible/**"
      ],
      "matchUpdateTypes": [
        "digest"
      ],
      "minimumReleaseAge": "0 days",
      "automerge": true,
      "automergeType": "pr",
      "addLabels": [
        "automerge"
      ],
      "description": "Auto-merge Docker digest updates in Ansible if CI passes"
    },
    {
      "matchDatasources": [
        "docker"
      ],
      "matchPackageNames": [
        "ghcr.io/cloudnative-pg/postgresql"
      ],
      "matchCurrentVersion": "/^17\\./",
      "automerge": true,
      "automergeType": "pr",
      "addLabels": [
        "db-image",
        "automerge"
      ],
      "description": "Auto-merge PostgreSQL 17.x updates"
    },
    {
      "matchDatasources": [
        "docker"
      ],
      "matchPackageNames": [
        "ghcr.io/cloudnative-pg/postgresql"
      ],
      "matchUpdateTypes": [
        "major"
      ],
      "automerge": false,
      "draftPR": true,
      "addLabels": [
        "db-major-upgrade"
      ],
      "prBodyNotes": [
        "PostgreSQL major version upgrade (e.g., 17â†’18). Verify backups, extension compatibility, and application compatibility before merging."
      ],
      "description": "PostgreSQL major version upgrades require manual review"
    },
    {
      "matchManagers": [
        "custom.regex"
      ],
      "matchPackageNames": [
        "esphome"
      ],
      "pinDigests": false,
      "description": "Disable digest pinning for ESPHome PyPI package"
    },
    {
      "matchManagers": [
        "dockerfile"
      ],
      "matchFileNames": [
        "Dockerfile.ansible",
        "tests/rpi/Dockerfile"
      ],
      "matchUpdateTypes": [
        "digest"
      ],
      "minimumReleaseAge": "0 days",
      "automerge": true,
      "automergeType": "pr",
      "addLabels": [
        "automerge"
      ],
      "description": "Auto-merge digest updates for CI/test Dockerfiles"
    },
    {
      "description": "MariaDB: LTS versions at least 6 months old (auto-managed)",
      "allowedVersions": "/^(11\\.8|11\\.4|10\\.11|10\\.6)\\./",
      "matchDatasources": [
        "docker"
      ],
      "matchPackageNames": [
        "mariadb"
      ]
    },
    {
      "description": "PostgreSQL: Major versions at least 6 months old (auto-managed)",
      "allowedVersions": "/^(17|16|15|14)\\./",
      "matchDatasources": [
        "docker"
      ],
      "matchPackageNames": [
        "ghcr.io/cloudnative-pg/postgresql"
      ]
    },
    {
      "description": "ESPHome: One month behind latest (auto-managed)",
      "allowedVersions": "/^2025\\.12\\./",
      "matchDatasources": [
        "pypi"
      ],
      "matchPackageNames": [
        "esphome"
      ]
    },
    {
      "description": "Home Assistant: One month behind latest (auto-managed)",
      "allowedVersions": "/^2026\\.1\\./",
      "matchDatasources": [
        "docker"
      ],
      "matchPackageNames": [
        "ghcr.io/home-assistant/home-assistant"
      ]
    }
  ],
  "gitIgnoredAuthors": [
    "github-actions[bot]@users.noreply.github.com"
  ]
}
