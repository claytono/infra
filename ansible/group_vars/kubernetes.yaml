---
ip_forwarding_enabled: true

kernel_parameters: "nofb vga=normal"

node_exporter_enabled: true

# Override containerd config to include conf.d imports
# Enables drop-in configs (e.g., nvidia runtime) without modifying main config
containerd_config: |
  imports = ["/etc/containerd/conf.d/*.toml"]
  version = 3
  [plugins]
    [plugins.'io.containerd.cri.v1.runtime']
      [plugins.'io.containerd.cri.v1.runtime'.containerd]
        default_runtime_name = 'runc'
        [plugins.'io.containerd.cri.v1.runtime'.containerd.runtimes]
          [plugins.'io.containerd.cri.v1.runtime'.containerd.runtimes.runc]
            runtime_type = 'io.containerd.runc.v2'
            [plugins.'io.containerd.cri.v1.runtime'.containerd.runtimes.runc.options]
              BinaryName = '/usr/local/sbin/runc'
              SystemdCgroup = true
      [plugins.'io.containerd.cri.v1.runtime'.cni]
        bin_dir = '/opt/cni/bin'
        conf_dir = '/etc/cni/net.d'

# Our goal is to stay one version behind
kubernetes_short_version: "1.33"
kubernetes_version: "1.33.5"
kubeadm_version: "1.33.5-1.1"
kubelet_version: "1.33.5-1.1"
kubectl_version: "1.33.5-1.1"
cri_tools_version: "1.33.0-1.1"
kubernetes_cni_version: "1.6.0-1.1"

# Kubernetes repository versions to maintain (current + previous for rollback)
kubernetes_repo_versions:
  - "1.33"
  - "1.32"

kubernetes_master: "k1.oneill.net"

# NVIDIA driver and toolkit versions (from NVIDIA CUDA repository)
nvidia_driver_version: "580.105.08-1"
nvidia_container_toolkit_version: "1.18.2-1"

kubeadm_bootstrap_token: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  37393365336231633462663537343639376433383634653964303735353734373034346532303963
  3364653161346537663063626538643834393332663535330a383863653166656538306463613636
  65356133366366336135643435376666646534393133356561623731376332626366616337306562
  6335323361316666610a356462393564373631663832373662626330633963646163363231396663
  65386339313332383538326337616562333863623139343736376135643531336365

iscsi_chap_username: kubernetes
iscsi_chap_password: !vault |
  $ANSIBLE_VAULT;1.1;AES256
  39323434383264653266613836326333613631336666393365656232646661613631643136316564
  3831393635643131323666303839343435303734343432340a323637643839386334323162643933
  64363638656163343465336337663763646233353937633062636532363861633934613833333335
  6666356333343931300a616663376361386666623561303862396366656561393833393731386565
  3232
