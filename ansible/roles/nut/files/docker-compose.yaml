---
services:
  peanut:
    image: brandawg93/peanut:latest@sha256:e3d60b03dae785d4fcd24074dd369d96d41ae37df23a3c06f3dcb2777cbb54f3
    restart: unless-stopped
    volumes:
      - /etc/nut/peanut-settings.yml:/config/settings.yml:ro

  caddy:
    build: .
    restart: unless-stopped
    ports:
      - "443:443"
    environment:
      AWS_ACCESS_KEY_ID: "${AWS_ACCESS_KEY_ID}"
      AWS_SECRET_ACCESS_KEY: "${AWS_SECRET_ACCESS_KEY}"
      AWS_REGION: "${AWS_REGION}"
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile:ro
      - /etc/ssl/caddy:/etc/ssl/caddy
    depends_on:
      - peanut
