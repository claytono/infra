---
services:
  peanut:
    image: brandawg93/peanut:latest@sha256:5a067c06814b193180c4e2487c2454f598702984c9f7fa6e1d2ffc8300ce0ed0
    restart: unless-stopped
    volumes:
      - /etc/nut/peanut-settings.yml:/config/settings.yml:ro

  caddy:
    build: .
    restart: unless-stopped
    ports:
      - "443:443"
    environment:
      AWS_ACCESS_KEY_ID: "${AWS_ACCESS_KEY_ID}"
      AWS_SECRET_ACCESS_KEY: "${AWS_SECRET_ACCESS_KEY}"
      AWS_REGION: "${AWS_REGION}"
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile:ro
      - /etc/ssl/caddy:/etc/ssl/caddy
    depends_on:
      - peanut
