---
services:
  peanut:
    image: brandawg93/peanut:latest@sha256:0b1bac17ed598fcefd1c0366a67431f21e209be29e4f2ab5c7cf895e4a2fb968
    restart: unless-stopped
    volumes:
      - /etc/nut/peanut-settings.yml:/config/settings.yml:ro

  caddy:
    build: .
    restart: unless-stopped
    ports:
      - "443:443"
    environment:
      AWS_ACCESS_KEY_ID: "${AWS_ACCESS_KEY_ID}"
      AWS_SECRET_ACCESS_KEY: "${AWS_SECRET_ACCESS_KEY}"
      AWS_REGION: "${AWS_REGION}"
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile:ro
      - /etc/ssl/caddy:/etc/ssl/caddy
    depends_on:
      - peanut
