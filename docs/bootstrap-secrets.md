# Bootstrap Secrets

The `scripts/bootstrap-secrets` script manages bootstrap secrets and credentials
required for infrastructure initialization, fetching them from 1Password and
deploying them to the appropriate locations.

## Purpose

- **Ansible** requires a vault password for encrypted variable access
- **1password-connect** requires credentials to authenticate with 1Password
- **external-secrets** requires a token to connect to 1password-connect
- These secrets must exist before dependent services start, but cannot be
  generated by the services themselves

## Usage

### Prerequisites

- 1Password CLI (`op`) installed and authenticated
- `kubectl` configured for target cluster (for Kubernetes secrets)

### Deploy Bootstrap Secrets

```bash
# Show what would change (diff mode - default)
./scripts/bootstrap-secrets

# Apply the changes
./scripts/bootstrap-secrets --apply
```

## What This Does

1. Updates Ansible vault password from 1Password (`ansible/ansible-vault-password`)
2. Creates required Kubernetes namespaces (`1password`, `external-secrets`)
3. Generates and applies `op-credentials` secret in `1password` namespace
4. Generates and applies `secrets` secret in `external-secrets` namespace

## Security Notes

- Secrets are fetched from 1Password vault "Kubernetes"
- Secrets are applied directly to cluster (not stored in git)

## Dependencies

- 1Password vault "Kubernetes" must contain:
  - `ansible-vault-password` document
  - `1password-credentials.json` document
  - `external-secrets-token` document
