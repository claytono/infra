#!/usr/bin/env bash

# ESPHome wrapper script using uvx
# Runs ESPHome via uv's tool execution for native serial port access

set -Eeuo pipefail

# ESPHome version
ESPHOME_VERSION="2025.12.2"

# Get the directory where this script is located
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Set the ESPHome config directory (parent of scripts directory)
ESPHOME_DIR="${ESPHOME_DIR:-$(dirname "$SCRIPT_DIR")}"

# Ensure we're in the ESPHome directory
cd "$ESPHOME_DIR" || exit 1

# Run ESPHome via uv with pip included (required by PlatformIO)
exec uv run --with pip --with "esphome==${ESPHOME_VERSION}" esphome "$@"
