---
# External secret for ARA API basic auth credentials
# Stored in 1Password, synced to Kubernetes
apiVersion: external-secrets.io/v1
kind: ExternalSecret

metadata:
  name: ara-basic-auth

spec:
  refreshInterval: 1h
  secretStoreRef:
    name: production
    kind: ClusterSecretStore
  target:
    name: ara-basic-auth
    template:
      data:
        # htpasswd format: username:$bcrypt_hash
        # The key MUST be named 'auth' for nginx ingress controller
        auth: '{{ .username }}:{{ .password_hash }}'
  dataFrom:
  - extract:
      key: ara-api-basic-auth
