---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: ara

components:
- ../components/authentik

resources:
- namespace.yaml
- ara-postgres-cluster.yaml
- ara-basic-auth-secret.yaml
- middleware-basic-auth.yaml
- ingress.yaml
- helm/deployment.yaml
- helm/extra-objects.yaml
- helm/pvc.yaml
- helm/service.yaml

patches:
- path: patch-deployment-password.yaml
  target:
    kind: Deployment
    name: ara-ara

images:
- name: docker.io/recordsansible/ara-api
  # Using fix-postgresql-migration image until 1.7.5 is released
  # See: https://codeberg.org/ansible-community/ara/issues/628
  # TODO: https://github.com/claytono/infra/issues/998
  newName: quay.io/recordsansible/ara-api
  newTag: fix-postgresql-migration@sha256:467952a2da68aee3d2fbb56aa05a4794fd24b2bb20d48de87d0f99d103296c69

commonAnnotations:
  argoManaged: 'true'
