---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: ara

components:
- ../components/authentik

resources:
- namespace.yaml
- ara-postgres-cluster.yaml
- ara-basic-auth-secret.yaml
- ingress.yaml
- helm/deployment.yaml
- helm/extra-objects.yaml
- helm/pvc.yaml
- helm/service.yaml

patches:
- path: patch-deployment-password.yaml
  target:
    kind: Deployment
    name: ara-ara

images:
- name: docker.io/recordsansible/ara-api
  # Pinned to 080334c to avoid broken migration 0018 in 8774f1c
  # See: https://codeberg.org/ansible-community/ara/issues/628
  newTag: latest@sha256:8774f1c567a57df1b7a5bf6a9627a42e99d90a5f9eae384e9641af67856832bf

commonAnnotations:
  argoManaged: 'true'
