---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: ara

components:
- ../components/authentik

resources:
- namespace.yaml
- ara-postgres-cluster.yaml
- ara-basic-auth-secret.yaml
- ingress.yaml
- helm/deployment.yaml
- helm/extra-objects.yaml
- helm/pvc.yaml
- helm/service.yaml

patches:
- path: patch-deployment-password.yaml
  target:
    kind: Deployment
    name: ara-ara

images:
- name: docker.io/recordsansible/ara-api
  # Pinned to 080334c to avoid broken migration 0018 in 8774f1c
  # See: https://codeberg.org/ansible-community/ara/issues/628
  newTag: latest@sha256:080334c1cf9a81eabb1cc1ed1e745cd2ddb184ce92b44d3a16fd5c6871ee4b06

commonAnnotations:
  argoManaged: 'true'
