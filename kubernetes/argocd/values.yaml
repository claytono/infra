---
server:
  containerPorts:
    server: 8443
  service:
    servicePortHttps: 443
    servicePortHttp: 80
  certificate:
    enabled: true
    domain: argocd.k.oneill.net
    issuer:
      kind: ClusterIssuer
      name: letsencrypt
  ingress:
    enabled: true
    ingressClassName: nginx
    hostname: argocd.k.oneill.net
    servicePort: https
    annotations:
      nginx.ingress.kubernetes.io/ssl-passthrough: 'true'
      nginx.ingress.kubernetes.io/force-ssl-redirect: 'true'
      gethomepage.dev/enabled: 'true'
      gethomepage.dev/name: Argo CD
      gethomepage.dev/description: GitOps Continuous Delivery
      gethomepage.dev/icon: mdi-git
      gethomepage.dev/group: Home Lab
    path: /
    pathType: Prefix

configs:
  cm:
    url: https://argocd.k.oneill.net
    # GitHub Actions service account configuration
    accounts.github-actions: apiKey
  rbac:
    # RBAC policy for GitHub Actions service account - minimal required permissions
    policy.csv: |
      # Allow GitHub Actions to read application status
      p, role:github-actions, applications, get, *, allow
      # Allow GitHub Actions to create applications
      p, role:github-actions, applications, create, *, allow
      # Allow GitHub Actions to trigger sync operations
      p, role:github-actions, applications, sync, *, allow
      # Allow GitHub Actions to update applications (needed for target revision changes)
      p, role:github-actions, applications, update, *, allow
      # Allow GitHub Actions to access projects (required for app operations)
      p, role:github-actions, projects, get, *, allow
      # Assign github-actions account to the role
      g, github-actions, role:github-actions
  notifications:
    argocdUrl: https://argocd.k.oneill.net
