---
version: 1

metadata:
  name: {{ app_name }}-basic-config

entries:
- identifiers:  # {{ app_name }} Proxy Provider (Basic Auth)
    name: {{ app_name }}
  id: {{ app_name }}_provider
  model: authentik_providers_proxy.proxyprovider
  state: present
  attrs:
    name: {{ app_name }}
    mode: forward_domain
    external_host: {{ external_host }}
    internal_host: {{ internal_host }}
    intercept_header_auth: true
    basic_auth_username_attribute: username
    basic_auth_password_attribute: password
    cookie_domain: oneill.net
{%- if skip_path_regex %}
    skip_path_regex: |-
{%- for line in skip_path_regex.split('\n') %}
      {{ line }}
{%- endfor %}
{%- endif %}
    authorization_flow: !Find
    - authentik_flows.flow
    - [slug, default-provider-authorization-implicit-consent]
    invalidation_flow: !Find
    - authentik_flows.flow
    - [slug, default-provider-invalidation-flow]
- identifiers:  # {{ app_name }} Application
    slug: {{ app_name }}
  id: {{ app_name }}_app
  model: authentik_core.application
  state: present
  attrs:
    name: {{ app_name }}
    provider: !KeyOf {{ app_name }}_provider
