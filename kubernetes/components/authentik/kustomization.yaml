---
apiVersion: kustomize.config.k8s.io/v1alpha1
kind: Component

patches:

# ak-type=simple (unified selector)
- target:
    group: networking.k8s.io
    version: v1
    kind: Ingress
    labelSelector: ak-type=simple
  patch: &simple-auth-patch |-
    - op: add
      path: /metadata/annotations/traefik.ingress.kubernetes.io~1router.middlewares
      value: authentik-ak-forward-auth-simple@kubernetescrd

- target:
    group: networking.k8s.io
    version: v1
    kind: Ingress
    annotationSelector: ak-type=simple
  patch: *simple-auth-patch

# ak-type=basic-auth (unified selector)
- target:
    group: networking.k8s.io
    version: v1
    kind: Ingress
    labelSelector: ak-type=basic-auth
  patch: &basic-auth-patch |-
    - op: add
      path: /metadata/annotations/traefik.ingress.kubernetes.io~1router.middlewares
      value: authentik-ak-forward-auth-basic@kubernetescrd

- target:
    group: networking.k8s.io
    version: v1
    kind: Ingress
    annotationSelector: ak-type=basic-auth
  patch: *basic-auth-patch
