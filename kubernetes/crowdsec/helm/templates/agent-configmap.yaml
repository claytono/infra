---
# Source: crowdsec/templates/agent-configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: crowdsec-parsers-s00-raw
data:
  unifi-loki.yaml: |
    filter: "evt.Line.Labels.type == 'unifi'"
    onsuccess: next_stage
    pattern_syntax:
      ACTION: (D|R|A)
      ZONE: (LAN|WAN|LOCAL|VPN|DMZ)
      UNIFI_FIREWALL_PREFIX: '\[(?:%{ZONE:src_zone}_)?%{ZONE:dst_zone}-%{ACTION:action}-%{INT:rule_id}\]'
    name: custom/unifi-loki
    nodes:
      - grok:
          pattern: "^%{UNIFI_FIREWALL_PREFIX}%{GREEDYDATA:message}"
          apply_on: Line.Raw
    statics:
      - parsed: program
        value: kernel
      - parsed: logsource
        value: loki
      - meta: log_type
        expression: 'evt.Parsed.action not in ["A"] ? "iptables_drop" : "iptables_event"'
      - meta: action
        expression: 'evt.Parsed.action == "" ? "" : evt.Parsed.action == "A" ? "accept" : (evt.Parsed.action == "D" ? "drop" : (evt.Parsed.action == "R" ? "reject" : "unknown"))'
      - meta: datasource_path
        expression: evt.Line.Src
      - meta: datasource_type
        expression: evt.Line.Module
---
# Source: crowdsec/templates/agent-configmap.yaml
---
