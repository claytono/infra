---
apiVersion: external-secrets.io/v1
kind: ExternalSecret

metadata:
  name: dawarich-secrets
  namespace: dawarich

spec:
  secretStoreRef:
    name: production
    kind: ClusterSecretStore
  refreshPolicy: CreatedOnce
  target:
    name: dawarich-secrets
    creationPolicy: Owner
  dataFrom:
  - rewrite:
    - regexp:
        source: password
        target: SECRET_KEY_BASE
    sourceRef:
      generatorRef:
        kind: Password
        name: dawarich-secret-key-base

---
apiVersion: external-secrets.io/v1
kind: ExternalSecret

metadata:
  name: dawarich-valkey-config
  namespace: dawarich

spec:
  secretStoreRef:
    name: production
    kind: ClusterSecretStore
  refreshPolicy: CreatedOnce
  target:
    name: dawarich-valkey-config
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        auth.conf: requirepass {{ .valkeypassword }}
        REDIS_URL: "redis://:{{ .valkeypassword }}@valkey:6379"
  dataFrom:
  - rewrite:
    - regexp:
        source: password
        target: valkeypassword
    sourceRef:
      generatorRef:
        kind: Password
        name: dawarich-valkey
