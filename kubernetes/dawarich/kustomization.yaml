---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: dawarich

commonAnnotations:
  argoManaged: 'true'

resources:
- namespace.yaml
- password-generators.yaml
- externalsecret.yaml
- externalsecret-oidc.yaml
- dawarich-postgres-cluster.yaml
- pvc-public.yaml
- pvc-watched.yaml
- pvc-storage.yaml
- deploy-web.yaml
- deploy-sidekiq.yaml
- service.yaml
- ingress.yaml
- helm/valkey/pvc.yaml
- helm/valkey/scripts.yaml
- helm/valkey/service-internal.yaml
- helm/valkey/services.yaml
- helm/valkey/statefulset.yaml

patches:
- path: patch-valkey-secret-mount.yaml
  target:
    kind: Deployment
    name: valkey

labels:

- pairs:
    app.kubernetes.io/name: dawarich
    app.kubernetes.io/instance: dawarich
  includeSelectors: true
