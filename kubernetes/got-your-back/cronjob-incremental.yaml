---
apiVersion: batch/v1
kind: CronJob

metadata:
  name: got-your-back-incremental

spec:
  schedule: 13 */4 * * *
  concurrencyPolicy: Forbid
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: got-your-back
            image: debian
            command: [/usr/local/bin/run, --fast-incremental]
            imagePullPolicy: Always
            env:
            - name: HEALTHCHECK_PING_KEY
              valueFrom:
                secretKeyRef:
                  name: healthchecks
                  key: HEALTHCHECK_PING_KEY
            - name: CHECK_NAME
              value: got-your-back-incremental
            volumeMounts:
            - name: config
              mountPath: /config
            - name: config-source
              mountPath: /config-source
            - name: run-script
              mountPath: /usr/local/bin/run
              subPath: run
            - name: got-your-back-data
              mountPath: /data
          volumes:
          - name: config
            emptyDir: {}
          - name: config-source
            secret:
              secretName: got-your-back
          - name: run-script
            configMap:
              name: run-script
              defaultMode: 0755
          - name: got-your-back-data
            persistentVolumeClaim:
              claimName: got-your-back-data
          restartPolicy: OnFailure
