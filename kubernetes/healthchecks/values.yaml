---
healthchecks:
  controller:
    annotations:
      reloader.stakater.com/auto: "true"

  env:
    TZ: America/New_York
    SITE_NAME: Healthchecks
    SITE_ROOT: https://hc.k.oneill.net
    ALLOWED_HOSTS: hc.k.oneill.net
    REGISTRATION_OPEN: "False"
    DEBUG: "False"

    # Database - CloudNative-PG
    DB: postgres
    DB_HOST: healthchecks-postgres-rw
    DB_NAME: healthchecks
    DB_USER:
      valueFrom:
        secretKeyRef:
          name: healthchecks-postgres-app
          key: username
    DB_PASSWORD:
      valueFrom:
        secretKeyRef:
          name: healthchecks-postgres-app
          key: password

    # Email via SMTP relay
    EMAIL_HOST: smtp.k.oneill.net
    EMAIL_PORT: "587"
    EMAIL_HOST_USER: relay@oneill.net
    EMAIL_USE_TLS: "True"
    DEFAULT_FROM_EMAIL: healthchecks@oneill.net

    # Authentik forward auth - use email header for user identification
    REMOTE_USER_HEADER: HTTP_X_AUTHENTIK_EMAIL

  # SECRET_KEY and EMAIL_HOST_PASSWORD from external secret
  envFrom:
  - secretRef:
      name: healthchecks

  service:
    main:
      ports:
        http:
          port: 8000

  ingress:
    main:
      enabled: true
      ingressClassName: nginx
      annotations:
        ak-type: simple
        ak-namespace: healthchecks
        ak-path-exclude: /api,/ping
        cert-manager.io/cluster-issuer: letsencrypt
        gethomepage.dev/enabled: 'true'
        gethomepage.dev/name: Healthchecks
        gethomepage.dev/group: Monitoring
        gethomepage.dev/icon: healthchecks.png
      hosts:
      - host: hc.k.oneill.net
        paths:
        - path: /
          pathType: Prefix
      tls:
      - secretName: healthchecks-tls
        hosts:
        - hc.k.oneill.net

  # Disable built-in PostgreSQL - we use CloudNative-PG
  postgresql:
    enabled: false
