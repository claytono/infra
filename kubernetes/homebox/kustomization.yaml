---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: default

resources:

- homebox-postgres-cluster.yaml

  # HomeBox resources
- helm/homebox/deployment.yaml
- helm/homebox/secrets.yaml
- helm/homebox/service.yaml
- helm/homebox/pvc.yaml
- helm/homebox/serviceaccount.yaml
- helm/homebox/ingress.yaml

commonAnnotations:
  argoManaged: 'true'

patches:

- target:
    kind: Deployment
    name: homebox
  patch: |-
    - op: add
      path: /spec/template/spec/containers/0/env
      value: []
    - op: add
      path: /spec/template/spec/containers/0/env/-
      value:
        name: HBOX_DATABASE_PASSWORD
        valueFrom:
          secretKeyRef:
            name: homebox-postgres-app
            key: password

# Add labels for metrics
labels:

- pairs:
    app.kubernetes.io/name: homebox
    app.kubernetes.io/instance: homebox
