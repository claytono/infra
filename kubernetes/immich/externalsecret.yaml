---
apiVersion: external-secrets.io/v1
kind: ExternalSecret

metadata:
  name: immich-oidc

spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: production
  target:
    name: immich-oidc
    creationPolicy: Owner
  data:
  - secretKey: OAUTH_CLIENT_ID
    remoteRef:
      key: immich-oidc
      property: client-id
  - secretKey: OAUTH_CLIENT_SECRET
    remoteRef:
      key: immich-oidc
      property: client-secret

---
apiVersion: external-secrets.io/v1
kind: ExternalSecret

metadata:
  name: immich-secrets

spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: production
  target:
    name: immich-secrets
    creationPolicy: Owner
  data:
  - secretKey: IMMICH_SECRET
    remoteRef:
      key: immich
      property: jwt_secret

---
apiVersion: external-secrets.io/v1
kind: ExternalSecret

metadata:
  name: immich-valkey

spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: production
  target:
    name: immich-valkey
    creationPolicy: Owner
  data:
  - secretKey: valkey-password
    remoteRef:
      key: immich
      property: valkey_password

---
apiVersion: external-secrets.io/v1
kind: ExternalSecret

metadata:
  name: immich-valkey-config

spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: production
  target:
    name: immich-valkey-config
    creationPolicy: Owner
    template:
      data:
        auth.conf: requirepass {{ .valkey_password }}
  data:
  - secretKey: valkey_password
    remoteRef:
      key: immich
      property: valkey_password
