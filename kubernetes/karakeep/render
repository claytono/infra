#!/usr/bin/env bash

set -eu -o pipefail

BASEDIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
cd "$BASEDIR"

source "$BASEDIR/../scripts/chart-version"

rm -rf helm tmp
mkdir -p tmp helm/karakeep

# Render Karakeep chart (chart and version from Chart.yaml)
helm_template karakeep karakeep --namespace karakeep --values values.yaml --output-dir tmp

# Move templates to helm
mv tmp/karakeep/templates/* helm/karakeep/
mv tmp/karakeep/charts/meilisearch/templates/ helm/meilisearch/

# Clean up
rm -rf tmp
rm -rf helm/*/tests

echo "Rendered Karakeep manifests into helm/karakeep/"
