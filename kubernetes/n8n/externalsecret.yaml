---
apiVersion: external-secrets.io/v1
kind: ExternalSecret

metadata:
  name: n8n-secrets
  namespace: n8n

spec:
  secretStoreRef:
    name: production
    kind: ClusterSecretStore
  target:
    name: n8n-secrets
    creationPolicy: Owner
  data:
  - secretKey: N8N_ENCRYPTION_KEY
    remoteRef:
      key: n8n
      property: encryption_key
  - secretKey: N8N_USER_MANAGEMENT_JWT_SECRET
    remoteRef:
      key: n8n
      property: jwt_secret

---
apiVersion: external-secrets.io/v1
kind: ExternalSecret

metadata:
  name: n8n-valkey-config

spec:
  secretStoreRef:
    name: production
    kind: ClusterSecretStore
  target:
    name: n8n-valkey-config
    creationPolicy: Owner
    template:
      data:
        auth.conf: requirepass {{ .valkey_password }}
  data:
  - secretKey: valkey_password
    remoteRef:
      key: n8n
      property: valkey_password

---
apiVersion: external-secrets.io/v1
kind: ExternalSecret

metadata:
  name: n8n-valkey

spec:
  secretStoreRef:
    name: production
    kind: ClusterSecretStore
  target:
    name: n8n-valkey
    creationPolicy: Owner
  data:
  - secretKey: valkey-password
    remoteRef:
      key: n8n
      property: valkey_password
