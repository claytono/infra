---
apiVersion: external-secrets.io/v1
kind: ExternalSecret

metadata:
  name: paperless-oidc

spec:
  secretStoreRef:
    kind: ClusterSecretStore
    name: production
  target:
    name: paperless-oidc
    creationPolicy: Owner
    template:
      data:
        PAPERLESS_SOCIALACCOUNT_PROVIDERS: |
          {"openid_connect":{"OAUTH_PKCE_ENABLED":true,"SCOPE":["openid","profile","email","groups"],"APPS":[{"provider_id":"authentik","name":"Authentik","client_id":"{{ .clientId }}","secret":"{{ .clientSecret }}","settings":{"server_url":"https://auth.k.oneill.net/application/o/paperless-ngx/.well-known/openid-configuration"}}]}}
  data:
  - secretKey: clientId
    remoteRef:
      key: paperless-ngx-oidc
      property: client-id
  - secretKey: clientSecret
    remoteRef:
      key: paperless-ngx-oidc
      property: client-secret
