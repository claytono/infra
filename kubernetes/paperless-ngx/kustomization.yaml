---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: paperless-ngx

commonAnnotations:
  argoManaged: 'true'

resources:
- namespace.yaml
- paperless-postgres-cluster.yaml
- externalsecret.yaml
- externalsecret-oidc.yaml
# Disabled until rclone credentials are configured:
# - externalsecret-rclone.yaml
# - configmap-rclone.yaml
# - configmap-sync-script.yaml
- pvc-data.yaml
- pvc-export.yaml
- pvc-valkey.yaml
- helm/paperless-ngx/common.yaml
- helm/valkey/scripts.yaml
- helm/valkey/service-internal.yaml
- helm/valkey/services.yaml
- helm/valkey/statefulset.yaml
- tika-deployment.yaml
- gotenberg-deployment.yaml

patches:

- target:
    kind: Deployment
    name: paperless-ngx
  patch: |-
    - op: add
      path: /spec/template/metadata/annotations
      value:
        reloader.stakater.com/auto: "true"

# Disabled until rclone credentials are configured:
# - path: patch-gdrive-sidecar.yaml
#   target:
#     kind: Deployment
#     name: paperless-ngx
