---
apiVersion: external-secrets.io/v1
kind: ExternalSecret

metadata:
  name: restic-rest-server-htpasswd

spec:
  secretStoreRef:
    name: production
    kind: ClusterSecretStore
  dataFrom:
  - extract:
      key: restic-rest-server
  target:
    name: restic-rest-server-htpasswd
    template:
      data:
        .htpasswd: |
          {{- range $field, $value := . }}
          {{- if hasSuffix "-htpasswd" $field }}
          {{- trimSuffix "-htpasswd" $field }}:{{ $value }}
          {{- end }}
          {{- end }}
---
apiVersion: external-secrets.io/v1
kind: ExternalSecret

metadata:
  name: restic-rest-server

spec:
  secretStoreRef:
    name: production
    kind: ClusterSecretStore
  target:
    name: restic-rest-server
  dataFrom:
  - extract:
      key: restic-rest-server
