###############################################
# Auto-generated by ak-tool for {{ app }} (proxy)
###############################################

resource "authentik_provider_proxy" "{{ app }}" {
  name                  = "{{ app }}"
  external_host         = "{{ external_host }}"
  internal_host         = "{{ internal_host }}"
  mode                  = "forward_domain"
  cookie_domain         = "oneill.net"
  authorization_flow    = data.authentik_flow.default_authorization.id
  invalidation_flow     = data.authentik_flow.default_invalidation.id
  access_token_validity = "hours=1"

  {% if basic %}
  basic_auth_enabled            = true
  basic_auth_username_attribute = "username"
  basic_auth_password_attribute = "password"
  {% endif %}

  {% if skip_path_regex %}
  skip_path_regex = <<-EOT
{{ skip_path_regex }}
  EOT
  {% endif %}
}

resource "authentik_application" "{{ app }}" {
  name              = "{{ app }}"
  slug              = "{{ app }}"
  protocol_provider = authentik_provider_proxy.{{ app }}.id
}
