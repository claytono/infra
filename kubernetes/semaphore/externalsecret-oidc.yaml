---
apiVersion: external-secrets.io/v1
kind: ExternalSecret

metadata:
  name: semaphore-oidc
  namespace: semaphore

spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: production

  target:
    name: semaphore-oidc
    creationPolicy: Owner
    template:
      data:
        oidc-config: |
          {
            "authentik": {
              "display_name": "Sign in with Authentik",
              "color": "#fd4b2d",
              "icon": "login",
              "provider_url": "https://auth.k.oneill.net/application/o/semaphore/",
              "client_id": "{{ .clientId }}",
              "client_secret": "{{ .clientSecret }}",
              "redirect_url": "https://semaphore.k.oneill.net/api/auth/oidc/authentik/redirect",
              "scopes": ["openid", "profile", "email"],
              "username_claim": "email",
              "email_claim": "email",
              "name_claim": "name"
            }
          }

  data:
  - secretKey: clientId
    remoteRef:
      key: semaphore-oidc
      property: client-id
  - secretKey: clientSecret
    remoteRef:
      key: semaphore-oidc
      property: client-secret
