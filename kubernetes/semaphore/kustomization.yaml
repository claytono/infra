---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: semaphore

resources:
- namespace.yaml
- semaphore-postgres-cluster.yaml
- externalsecret.yaml
- externalsecret-ansible-vault.yaml
- externalsecret-ara.yaml
- externalsecret-encryption.yaml
- externalsecret-oidc.yaml
- tailscale-ingress.yaml
- helm/configmap.yaml
- helm/deployment.yaml
- helm/ingress.yaml
- helm/pvc.yaml
- helm/service.yaml
- helm/serviceaccount.yaml
- idempotency-test/

configMapGenerator:
- name: semaphore-infra
  files:
  - flake.nix
  - flake.lock
  - scripts__init-tools.sh=scripts/init-tools.sh
  - scripts__setup-nix.sh=scripts/setup-nix.sh
  - scripts__ansible-wrapper.sh=scripts/ansible-wrapper.sh
  options:
    disableNameSuffixHash: true

patches:
- path: patch-deployment.yaml
  target:
    kind: Deployment
    name: semaphore

commonAnnotations:
  argoManaged: 'true'
