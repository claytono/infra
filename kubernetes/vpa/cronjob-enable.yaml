---
apiVersion: batch/v1
kind: CronJob
metadata:
  name: vpa-updater-enable
  namespace: vpa
spec:
  schedule: "0 1 * * *"
  timeZone: America/New_York
  successfulJobsHistoryLimit: 3
  failedJobsHistoryLimit: 3
  jobTemplate:
    spec:
      template:
        spec:
          serviceAccountName: vpa-maintenance
          restartPolicy: OnFailure
          containers:
          - name: toggle-updater
            image: alpine:3.22@sha256:4b7ce07002c69e8f3d704a9c5d6fd3053be500b7f1c69fc0d80990c2ad8dd412
            command: ["/bin/sh", "-c"]
            args:
            - |
              apk add --no-cache curl
              curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
              chmod +x kubectl
              mv kubectl /usr/local/bin/
              /scripts/toggle-updater on
            volumeMounts:
            - name: scripts
              mountPath: /scripts
          volumes:
          - name: scripts
            configMap:
              name: vpa-maintenance-scripts
              defaultMode: 0755
